I"(<p>BÃ i viáº¿t nÃ y sáº½ trÃ¬nh bÃ y cÃ¡c cÃ i Ä‘áº·t há»‡ thá»‘ng Linux Ä‘á»ƒ lÃ m viá»‡c tá»‘t hÆ¡n vá»›i <a href="https://www.docker.com/">Docker</a>.</p>

<p><strong>Nhá»¯ng ná»™i dung chÃ­nh:</strong></p>

<!-- MarkdownTOC -->
<ul>
  <li><a href="#-manage-docker-as-a-non-root-user">1. Quáº£n lÃ½ Docker vá»›i má»™t ngÆ°á»i dÃ¹ng non-root</a></li>
  <li><a href="#-configure-docker-to-start-on-boot">2. Cáº¥u hÃ¬nh Docker Ä‘á»ƒ khá»Ÿi Ä‘á»™ng cÃ¹ng vá»›i há»‡ thá»‘ng</a></li>
  <li><a href="#-configure-where-the-docker-daemon-listens-for-connections">3. Cáº¥u hÃ¬nh nÆ¡i Docker daemon láº¯ng nghe cÃ¡c káº¿t ná»‘i</a>
    <ul>
      <li><a href="#-configuring-remote-access-with-systemd-unit-file">3.1. Cáº¥u hÃ¬nh truy cáº­p tá»« xa vá»›i systemd</a></li>
      <li><a href="#-configuring-remote-access-with-daemon-json">3.2. Cáº¥u hÃ¬nh truy cáº­p tá»« xa vá»›i daemon.json</a><br />
<!-- /MarkdownTOC --></li>
    </ul>
  </li>
</ul>

<p><a name="-manage-docker-as-a-non-root-user"><a></a></a></p>
<h2 id="1-quáº£n-lÃ½-docker-vá»›i-má»™t-ngÆ°á»i-dÃ¹ng-non-root">1. Quáº£n lÃ½ Docker vá»›i má»™t ngÆ°á»i dÃ¹ng non-root</h2>

<p>Docker daemon gáº¯n vá»›i má»™t <a href="https://en.wikipedia.org/wiki/Unix_domain_socket">UNIX socket</a> thay vÃ¬ má»™t cá»•ng <a href="https://en.wikipedia.org/wiki/Transmission_Control_Protocol">TCP</a>. Máº·c Ä‘á»‹nh, má»™t Unix socket Ä‘Æ°á»£c sá»Ÿ há»¯u bá»Ÿi ngÆ°á»i dÃ¹ng <code class="highlighter-rouge">root</code> vÃ  nhá»¯ng ngÆ°á»i dÃ¹ng khÃ¡c trÃªn há»‡ thá»‘ng chá»‰ cÃ³ thá»ƒ truy cáº­p nÃ³ báº±ng cÃ¡ch dÃ¹ng lá»‡nh <code class="highlighter-rouge">sudo</code>. Docker daemon luÃ´n cháº¡y nhÆ° ngÆ°á»i dÃ¹ng <code class="highlighter-rouge">root</code>.</p>

<p>Náº¿u báº¡n khÃ´ng muá»‘n pháº£i cháº¡y lá»‡nh <code class="highlighter-rouge">docker</code> vá»›i <code class="highlighter-rouge">sudo</code>, hÃ£y táº¡o má»™t nhÃ³m ngÆ°á»i dÃ¹ng (group) cÃ³ tÃªn lÃ  <code class="highlighter-rouge">docker</code> vÃ  thÃªm ngÆ°á»i dÃ¹ng hiá»‡n táº¡i vÃ o nhÃ³m Ä‘Ã³. Khi Docker daemon khá»Ÿi Ä‘á»™ng, nÃ³ sáº½ táº¡o má»™t Unix socket Ä‘Æ°á»£c truy cáº­p bá»Ÿi cÃ¡c thÃ nh viÃªn cá»§a nhÃ³m ngÆ°á»i dÃ¹ng <code class="highlighter-rouge">docker</code>.</p>

<blockquote>
  <p>NhÃ³m ngÆ°á»i dÃ¹ng <code class="highlighter-rouge">docker</code> cáº¥p cÃ¡c quyá»n tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i ngÆ°á»i dÃ¹ng <code class="highlighter-rouge">root</code>.</p>
</blockquote>

<ul>
  <li>Táº¡o nhÃ³m ngÆ°á»i dÃ¹ng <code class="highlighter-rouge">docker</code>
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>groupadd docker
</code></pre></div>    </div>
  </li>
  <li>ThÃªm ngÆ°á»i dÃ¹ng vÃ o nhÃ³m <code class="highlighter-rouge">docker</code>
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>usermod <span class="nt">-aG</span> docker <span class="nv">$USER</span>
</code></pre></div>    </div>
  </li>
  <li>ÄÄƒng xuáº¥t vÃ  Ä‘Äƒng nháº­p láº¡i phiÃªn cá»§a ngÆ°á»i dÃ¹ng hiá»‡n táº¡i, kiá»ƒm tra xem ngÆ°á»i dÃ¹ng hiá»‡n táº¡i Ä‘Ã£ Ä‘Æ°á»£c thÃªm vÃ o nhÃ³m <code class="highlighter-rouge">docker</code> hay chÆ°a?
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">groups</span>
</code></pre></div>    </div>
  </li>
  <li>Cháº¡y <code class="highlighter-rouge">docker</code> mÃ  khÃ´ng cáº§n dÃ¹ng <code class="highlighter-rouge">sudo</code>
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">-it</span> ubuntu bash
</code></pre></div>    </div>
    <p>DÃ²ng lá»‡nh trÃªn sáº½ download má»™t test image vá» vÃ  cháº¡y nÃ³ trong má»™t container. Done:)</p>
  </li>
</ul>

<p><a name="-configure-docker-to-start-on-boot"><a></a></a></p>
<h2 id="2-cáº¥u-hÃ¬nh-docker-Ä‘á»ƒ-khá»Ÿi-Ä‘á»™ng-cÃ¹ng-vá»›i-há»‡-thá»‘ng">2. Cáº¥u hÃ¬nh Docker Ä‘á»ƒ khá»Ÿi Ä‘á»™ng cÃ¹ng vá»›i há»‡ thá»‘ng</h2>

<p>Háº§u háº¿t cÃ¡c báº£n pháº§n phá»‘i Linux (RHEL, CentOS, Fedora, Ubuntu 16.04 hoáº·c má»›i hÆ¡n) dÃ¹ng <code class="highlighter-rouge">systemd</code> Ä‘á»ƒ quáº£n lÃ½ cÃ¡c service khá»Ÿi Ä‘á»™ng cÃ¹ng vá»›i há»‡ thá»‘ng. Báº£n Ubuntu 14.10 hoáº·c cÅ© hÆ¡n dÃ¹ng <code class="highlighter-rouge">upstart</code>.</p>

<ul>
  <li>DÃ¹ng <code class="highlighter-rouge">systemd</code>:</li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>systemctl <span class="nb">enable </span>docker

Synchronizing state of docker.service with SysV init with /lib/systemd/systemd-sysv-install...
Executing /lib/systemd/systemd-sysv-install <span class="nb">enable </span>docker
</code></pre></div></div>

<p>Äá»ƒ vÃ´ hiá»‡u quÃ¡ docker:</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>systemctl disable docker
</code></pre></div></div>

<ul>
  <li>DÃ¹ng <code class="highlighter-rouge">upstart</code>:</li>
</ul>

<p>Docker Ä‘Æ°á»£c tá»± Ä‘á»™ng cáº¥u hÃ¬nh Ä‘á»ƒ khá»Ÿi Ä‘á»™ng cÃ¹ng vá»›i há»‡ thá»‘ng dÃ¹ng <code class="highlighter-rouge">upstart</code>. Äá»ƒ vÃ´ hiá»‡u hÃ³a, ta dÃ¹ng lá»‡nh sau Ä‘Ã¢y:</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">echo </span>manual | <span class="nb">sudo tee</span> /etc/init/docker.override
</code></pre></div></div>

<p><a name="-configure-where-the-docker-daemon-listens-for-connections"><a></a></a></p>
<h2 id="3-cáº¥u-hÃ¬nh-nÆ¡i-docker-daemon-láº¯ng-nghe-cÃ¡c-káº¿t-ná»‘i">3. Cáº¥u hÃ¬nh nÆ¡i Docker daemon láº¯ng nghe cÃ¡c káº¿t ná»‘i</h2>

<p>Máº·c Ä‘á»‹nh, Docker daemon láº¯ng nghe cÃ¡c káº¿t ná»‘i trÃªn má»™t Unix socket Ä‘á»ƒ cháº¥p nháº­n cÃ¡c yÃªu cáº§u (requests) tá»« cÃ¡c mÃ¡y khÃ¡ch cá»¥ bá»™ (local clients). CÃ³ thá»ƒ cho phÃ©p Docker cháº¥p nháº­n cÃ¡c yÃªu cáº§u tá»« cÃ¡c mÃ¡y chá»§ tá»« xa (remote hosts) báº±ng cÃ¡ch cáº¥u hÃ¬nh nÃ³ Ä‘á»ƒ láº¯ng nghe trÃªn má»™t Ä‘á»‹a chá»‰ IP vÃ  cá»•ng (port) cÅ©ng nhÆ°ng lÃ  má»™t Unix socket. á» Ä‘Ã¢y cÃ³ thá»ƒ hiá»ƒu ráº±ng: <code class="highlighter-rouge">Unix socket = IP + Port</code>.</p>

<p><a name="-configuring-remote-access-with-systemd-unit-file"><a></a></a></p>
<h3 id="31-cáº¥u-hÃ¬nh-truy-cáº­p-tá»«-xa-vá»›i-systemd">3.1. Cáº¥u hÃ¬nh truy cáº­p tá»« xa vá»›i <code class="highlighter-rouge">systemd</code></h3>

<ul>
  <li>Má»Ÿ file <code class="highlighter-rouge">docker.service</code> báº±ng lá»‡nh:
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>systemctl edit docker.service
</code></pre></div>    </div>
  </li>
  <li>ThÃªm hoáº·c chá»‰nh sá»­a ná»™i dung dÆ°á»›i Ä‘Ã¢y vÃ o file
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[Service]
ExecStart=
ExecStart=/usr/bin/dockerd -H fd:// -H tcp://127.0.0.1:2375
</code></pre></div>    </div>
  </li>
  <li>Reload láº¡i cáº¥u hÃ¬nh <code class="highlighter-rouge">systemctl</code>
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>systemctl daemon-reload
</code></pre></div>    </div>
  </li>
  <li>Khá»Ÿi Ä‘á»™ng láº¡i Docker
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>systemctl restart docker.service
</code></pre></div>    </div>
  </li>
  <li>Kiá»ƒm tra láº¡i thay Ä‘á»•i Ä‘Ã£ Ä‘Æ°á»£c Ã¡p dá»¥ng chÆ°a báº±ng cÃ¡ch xem Ä‘áº§u ra cá»§a <code class="highlighter-rouge">netstat</code> Ä‘á»ƒ xÃ¡c nháº­n ráº±ng <code class="highlighter-rouge">dockerd</code> Ä‘ang Ä‘Æ°á»£c láº¯ng nghe trÃªn cá»•ng Ä‘Ã£ Ä‘Æ°á»£c cáº¥u hÃ¬nh.</li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>netstat <span class="nt">-lntp</span> | <span class="nb">grep </span>dockerd

tcp        0      0 127.0.0.1:2375          0.0.0.0:<span class="k">*</span>               LISTEN      1196/dockerd
</code></pre></div></div>

<p><a name="-configuring-remote-access-with-daemon-json"><a></a></a></p>
<h3 id="32-cáº¥u-hÃ¬nh-truy-cáº­p-tá»«-xa-vá»›i-daemonjson">3.2. Cáº¥u hÃ¬nh truy cáº­p tá»« xa vá»›i <code class="highlighter-rouge">daemon.json</code></h3>

<ul>
  <li>Thiáº¿t láº­p máº£ng <code class="highlighter-rouge">hosts</code> trong file <code class="highlighter-rouge">/etc/docker/daemon.json</code> Ä‘á»ƒ káº¿t ná»‘i Ä‘áº¿n Unix socket vÃ  Ä‘á»‹a chá»‰ IP
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>vi /etc/docker/daemon.json
</code></pre></div>    </div>
  </li>
  <li>ThÃªm vÃ o ná»™i dung sau vÃ o file <code class="highlighter-rouge">/etc/docker/daemon.json</code>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
"hosts": ["unix:///var/run/docker.sock", "tcp://127.0.0.1:2375"]
}
</code></pre></div>    </div>
  </li>
  <li>Khá»Ÿi Ä‘á»™ng láº¡i Docker
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>systemctl restart docker.service
</code></pre></div>    </div>
  </li>
  <li>Kiá»ƒm tra láº¡i thay Ä‘á»•i Ä‘Ã£ Ä‘Æ°á»£c Ã¡p dá»¥ng chÆ°a báº±ng cÃ¡ch xem Ä‘áº§u ra cá»§a <code class="highlighter-rouge">netstat</code> Ä‘á»ƒ xÃ¡c nháº­n ráº±ng <code class="highlighter-rouge">dockerd</code> Ä‘ang Ä‘Æ°á»£c láº¯ng nghe trÃªn cá»•ng Ä‘Ã£ Ä‘Æ°á»£c cáº¥u hÃ¬nh.</li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>netstat <span class="nt">-lntp</span> | <span class="nb">grep </span>dockerd

tcp        0      0 127.0.0.1:2375          0.0.0.0:<span class="k">*</span>               LISTEN      1196/dockerd
</code></pre></div></div>
:ET