I"|4<p>Dữ liệu của một chương trình viết bằng <a href="https://www.python.org/">Python</a> có thể chứa nhiều loại thông tin khác nhau, chẳng hạn như một game sẽ yêu cầu người chơi nhập vào username và chương trình này sẽ lưu lại điểm số sau mỗi lượt chơi, các tuỳ chọn thiết lập trong game… Dù thông tin ở dạng nào đi nữa thì chúng cũng sẽ được lưu trong các cấu trúc dữ liệu mà ngôn ngữ lập trình Python hỗ trợ như: danh sách (<strong>lists</strong>) hoặc từ điển (<strong>dictionaries</strong>). Khi người dùng đóng chương trình, những thông tin được tạo ra trong quá trình chạy chương trình (phải) được lưu lại. Một biện pháp đơn giản để thực hiện việc này là lưu trữ data bằng cách sử dụng mô-đun (module) <strong>json</strong>.</p>

<p>Mô-đun <strong>json</strong> cho phép <strong><em>dump</em></strong> (từ này mình không biết nên Việt hóa như thế nào nữa? :D) một cấu trúc dữ liệu Python đơn giản vào một file và tải (load) dữ liệu từ file đó vào lần chạy tiếp theo của chương trình. Người phát triển có thể dùng <strong>json</strong> để chia sẻ dữ liệu giữa các chương trình Python khác nhau. Một ưu điểm vượt trội khác là kiểu dữ liệu <strong>JSON</strong> được thiết kế để không chỉ dùng riêng cho Python nên người phát triển có thể chia sẻ dữ liệu lưu trữ ở định dạng JSON với những người phát triển ngôn ngữ lập trình khác, nó rất hữu ích và khả chuyển (portable).</p>

<blockquote>
  <p>JSON (JavaScript Object Notation): Ban đầu JSON được phát triển cho JavaScript. Tuy nhiên, nó đã trở nên phổ biến và được dùng bởi nhiều ngôn ngữ lập trình khác, trong đó có Python.</p>
</blockquote>

<p><strong>Trong bài viết:</strong></p>

<!-- MarkdownTOC -->
<p><a href="#1-json-dump-load">1. json.dump() và json.load()</a><br />
<a href="#2-saving-reading-user-generated-data">2. Lưu trữ và đọc dữ liệu User-Generated</a><br />
<!-- /MarkdownTOC --></p>

<p><a name="1-json-dump-load"><a></a></a></p>
<h2 id="1-jsondump-và-jsonload">1. json.dump() và json.load()</h2>
<p>Chương trình <strong>number_writer.py</strong> lưu trữ một tập hợp các số và chương trình <strong>number_reader.py</strong> đọc những con số này ngược trở lại bộ nhớ. Chương trình thứ nhất sẽ sử dụng <code class="highlighter-rouge">json.dump()</code> để lưu trữ tập hợp số và chương trình thứ hai sử dụng <code class="highlighter-rouge">json.load()</code>.</p>

<p>Hàm <code class="highlighter-rouge">json.dump()</code> nhận 2 đối số (arguments):</p>
<ul>
  <li>Dữ liệu lưu trữ</li>
  <li>Đối tượng file dùng để lưu trữ dữ liệu.</li>
</ul>

<p><em>number_writer.py</em></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">json</span>

<span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s">'numbers.json'</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_obj</span><span class="p">:</span>
	<span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">numbers</span><span class="p">,</span> <span class="n">f_obj</span><span class="p">)</span>
</code></pre></div></div>
<p>Hàm <code class="highlighter-rouge">json.dump()</code> sẽ lưu trữ danh sách <code class="highlighter-rouge">numbers = [2, 3, 5, 7, 11, 13]</code> vào tệp <em>numbers.json</em>. Chương trình phía trên không có output nào ra console, nhưng nó sẽ tạo ra tệp <em>numbers.json</em> lưu trữ danh sách numbers theo định dạng giống như Python:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ python number_writer.py
$ cat numbers.json
[2, 3, 5, 7, 11, 13]
</code></pre></div></div>

<p>Tiếp theo chương trình thứ hai <strong>number_reader.py</strong> sử dụng <code class="highlighter-rouge">json.load()</code> để đọc danh sách numbers ngược trở lại bộ nhớ.</p>

<p><em>number_reader.py</em></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">json</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s">'numbers.json'</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_obj</span><span class="p">:</span>
	<span class="n">numbers</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f_obj</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
</code></pre></div></div>
<p>Hàm <code class="highlighter-rouge">json.load()</code> đọc thông tin lưu trữ trong tệp <em>numbers.json</em> và lưu thông tin vào biến numbers, chương trình sẽ in ra danh sách các số giống như danh sách được tạo ở <strong>number_writer.py</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ python number_reader.py
[2, 3, 5, 7, 11, 13]
</code></pre></div></div>
<p>Nội dung trên đã trình bày một cách đơn giản để chia sẻ dữ liệu giữa 2 chương trình.</p>

<p><a name="2-saving-reading-user-generated-data"><a></a></a></p>
<h2 id="2-lưu-trữ-và-đọc-dữ-liệu-user-generated">2. Lưu trữ và đọc dữ liệu User-Generated</h2>
<p>Lưu dữ liệu bằng <strong>json</strong> thực sự hữu ích khi làm việc với dữ liệu do người dùng tạo ra (User-Generated Data), bởi vì nếu không lưu thông tin của người dùng bằng một cách nào đó sẽ dẫn đến sự mất mát thông tin khi chương trình ngừng chạy. Ví dụ dưới đây sẽ lưu tên của người dùng nhập vào ở lần chạy đầu tiên và sau đó nhớ tên của họ ở những lần chạy tiếp theo.</p>

<p><em>remember_me.py</em></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">json</span>

<span class="n">username</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"What's your name? "</span><span class="p">)</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s">'username.json'</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_obj</span><span class="p">:</span>
	<span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">f_obj</span><span class="p">)</span>
	<span class="k">print</span><span class="p">(</span><span class="s">"We'll remember you when you come back, "</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="s">"!"</span><span class="p">)</span>
</code></pre></div></div>
<p>Khi chạy chương trình trên, username sẽ được lưu vào file <em>username.json</em> và in ra màn hình thông báo rằng chương trình đã lưu tên người dùng cho lần chạy tiếp theo.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ python3 remember_me.py
What's your name? TruongNH
We'll remember you when you come back, TruongNH!
$ cat username.json
"TruongNH"
</code></pre></div></div>
<p>Chương trình mới dưới đây sẽ in ra lời chào với người dùng mà username đã được lưu trữ trước đó.</p>

<p><em>greet_user.py</em></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">json</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s">'username.json'</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_obj</span><span class="p">:</span>
	<span class="n">username</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f_obj</span><span class="p">)</span>
	<span class="k">print</span><span class="p">(</span><span class="s">"Welcome back, "</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="s">"!"</span><span class="p">)</span>
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ python3 greet_user.py
Welcome back, TruongNH!
</code></pre></div></div>

<p>Gộp hai chương trình trên vào một file mã nguồn, khi chạy chương trình <em>remember_me.py</em>, người dùng muốn lấy username từ bộ nhớ nếu có thể; do đó người phát triển sẽ dùng một khối <code class="highlighter-rouge">try</code>. Nếu file <em>username.json</em> không tồn tại, sẽ có khối <code class="highlighter-rouge">except</code> nhắc lệnh truyền một username vào và lưu tại file <em>username.json</em> dùng cho lần sau:</p>

<p><em>remember_me.py</em></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">json</span>

<span class="c1"># Load the username, if it has been stored previously.
# Otherwise, prompt for the username and store it
</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s">'username.json'</span>
<span class="k">try</span><span class="p">:</span>
	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_obj</span><span class="p">:</span>
		<span class="n">username</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f_obj</span><span class="p">)</span>
<span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
	<span class="n">username</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"What's your name? "</span><span class="p">)</span>
	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_obj</span><span class="p">:</span>
		<span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">f_obj</span><span class="p">)</span>
		<span class="k">print</span><span class="p">(</span><span class="s">"We'll remember you when you come back, "</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="s">"!"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
	<span class="k">print</span><span class="p">(</span><span class="s">"Welcome back, "</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="s">"!"</span><span class="p">)</span>
</code></pre></div></div>
<p>Nếu lần đầu chương trình trên được chạy: <code class="highlighter-rouge">$ python3 remember_me.py</code></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>What's your name? Nguyen Hai Truong
We'll remember you when you come back, Nguyen Hai Truong!
</code></pre></div></div>
<p>Hoặc:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Welcome back, Nguyen Hai Truong!
</code></pre></div></div>

<p><em>Nguồn: <a href="https://www.amazon.com/Python-Crash-Course-Hands-Project-Based/dp/1593276036">Python Crash Course: A Hands-On, Project-Based Introduction to Programming</a></em></p>
:ET